local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local whitelist = {
    ["SadNii4"] = true,
    ["82iwkwjw3"] = true,
    ["EternaIKing_ofc"] = true,
    ["EternalQueen_ofc"] = true,
    ["OfEternal_king"] = true,
    ["OfEternal_queen"] = true,
    ["PROPLAYER292827"] = true,
    ["ilvieharbor73"] = true,
    ["TOQUIO_94"] = true,
    ["TOQUIO_944"] = true,
    ["ARMY_S0LDIER8"] = true,
    ["dorrido13"] = true,
    ["PEBUGADOTUTORIAL"] = true,
    ["TheLittle8Prince"] = true,
    ["Italo444hzx"] = true,
    ["NOOB_SEUPESADELO"] = true,
    ["Voa_Passarinho8"] = true,
    ["SadNii0"] = true,
    ["NeezXIX"] = true,
    ["Nicke_Nii"] = true,
    ["KillMachineFatality"] = true,
    ["Kansas_Girl8"] = true,
    ["Maveick01"] = true,
    ["XXDuquesa_julianaXX"] = true,
    ["jwjw82iwjw"] = true,
    ["LuaWorldV99"] = true,
    ["User27"] = true,
    ["User28"] = true,
    ["User29"] = true,
    ["User30"] = true,
    ["User31"] = true,
    ["User32"] = true,
    ["User33"] = true,
    ["User34"] = true,
    ["User35"] = true,
    ["User36"] = true,
    ["User37"] = true,
    ["User38"] = true,
    ["User39"] = true
}

if not whitelist[LocalPlayer.Name] then
    LocalPlayer:Kick("Voce nao esta na whitelist para usar este script.")
    return
end

print("Usuario autorizado:", LocalPlayer.Name)

game:GetService("Players").LocalPlayer.Idled:Connect(function()
    game:GetService("VirtualUser"):Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    wait(1)
    game:GetService("VirtualUser"):Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
end)

local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/memejames/elerium-v2-ui-library//main/Library"))()

local window = library:AddWindow("Muscle Legends V4 | Sad Scripts", {
    main_color = Color3.fromRGB(47, 78, 144),
    min_size = Vector2.new(550, 550),
    can_resize = false,
})

local Farming = window:AddTab("Farming")

local autoWinBrawlSwitch = Farming:AddSwitch("Auto Win Brawls", function(bool)
    getgenv().autoWinBrawl = bool
    
    local alreadyInBrawl = false
    
    local function equipPunch()
        if not getgenv().autoWinBrawl then return false end
        
        local player = game.Players.LocalPlayer
        local character = player.Character
        if not character then return false end
        
        if character:FindFirstChild("Punch") then return true end
        
        local backpack = player.Backpack
        if not backpack then return false end
        
        local punchTool = backpack:FindFirstChild("Punch")
        if punchTool and punchTool.ClassName == "Tool" then
            punchTool.Parent = character
            return true
        end
        
        return false
    end
    
    local function isValidTarget(player)
        if not player or not player.Parent then return false end
        if player == game.Players.LocalPlayer then return false end
        if whitelist and whitelist[player.UserId] then return false end
        
        local character = player.Character
        if not character or not character.Parent then return false end
        
        local humanoid = character:FindFirstChild("Humanoid")
        if not humanoid then return false end
        
        if humanoid.Health <= 0 then return false end
        
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not rootPart then return false end
        
        return true
    end
    
    local function isLocalPlayerReady()
        local player = game.Players.LocalPlayer
        if not player then return false end
        
        local character = player.Character
        if not character then return false end
        
        local humanoid = character:FindFirstChild("Humanoid")
        if not humanoid or humanoid.Health <= 0 then return false end
        
        return true
    end
    
    local function performPunch()
        if not isLocalPlayerReady() then return end
        
        local player = game.Players.LocalPlayer
        pcall(function()
            player.muscleEvent:FireServer("punch", "rightHand")
            task.wait(0.1)
            player.muscleEvent:FireServer("punch", "leftHand")
        end)
    end
    
    local function attackTarget(target)
        if not getgenv().autoWinBrawl then return end
        if not isLocalPlayerReady() then return end
        
        local character = game.Players.LocalPlayer.Character
        local targetChar = target.Character
        if not targetChar then return end
        
        local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
        if not targetRoot then return end
        
        local leftHand = character:FindFirstChild("LeftHand")
        local rightHand = character:FindFirstChild("RightHand")
        
        performPunch()
        
        if rightHand then
            firetouchinterest(rightHand, targetRoot, 0)
            task.wait(0.05)
            firetouchinterest(rightHand, targetRoot, 1)
        end
        
        task.wait(0.1)
        
        if leftHand then
            firetouchinterest(leftHand, targetRoot, 0)
            task.wait(0.05)
            firetouchinterest(leftHand, targetRoot, 1)
        end
    end

    task.spawn(function()
        while getgenv().autoWinBrawl and task.wait(2) do
            if not getgenv().autoWinBrawl then 
                alreadyInBrawl = false
                break 
            end
            
            pcall(function()
                local joinLabel = game.Players.LocalPlayer.PlayerGui.gameGui.brawlJoinLabel
                if joinLabel and joinLabel.Visible and not alreadyInBrawl then
                    game.ReplicatedStorage.rEvents.brawlEvent:FireServer("joinBrawl")
                    alreadyInBrawl = true
                    print("Entrou na Brawl!")
                    task.wait(3)
                end
                
                if not game.ReplicatedStorage.brawlInProgress.Value then
                    alreadyInBrawl = false
                end
            end)
        end
    end)
    
    task.spawn(function()
        while getgenv().autoWinBrawl and task.wait(1) do
            if not getgenv().autoWinBrawl then break end
            equipPunch()
        end
    end)
    
    task.spawn(function()
        while getgenv().autoWinBrawl and task.wait(0.2) do
            if not getgenv().autoWinBrawl then break end
            
            if isLocalPlayerReady() and game.ReplicatedStorage.brawlInProgress.Value then
                for _, player in pairs(game.Players:GetPlayers()) do
                    if not getgenv().autoWinBrawl then break end
                    
                    if isValidTarget(player) then
                        attackTarget(player)
                        task.wait(0.15) -- Small delay between targets
                    end
                end
            end
        end
    end)
    
    task.spawn(function()
        local lastPosition = Vector3.new(0, 0, 0)
        local stuckCounter = 0
        
        while getgenv().autoWinBrawl and task.wait(2) do
            if not getgenv().autoWinBrawl then break end
            
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local currentPosition = character.HumanoidRootPart.Position
                
                if (currentPosition - lastPosition).Magnitude < 2 then
                    stuckCounter = stuckCounter + 1
                    
                    if stuckCounter > 3 then
                        pcall(function()
                            local punch = character:FindFirstChild("Punch")
                            if punch then
                                punch.Parent = game.Players.LocalPlayer.Backpack
                                task.wait(0.2)
                                equipPunch()
                            end
                        end)
                        stuckCounter = 0
                    end
                else
                    stuckCounter = 0
                end
                
                lastPosition = currentPosition
            end
        end
    end)
end)

Farming:AddSwitch("Auto Join Brawl", function(bool)
    getgenv().autoJoinBrawl = bool
    
    task.spawn(function()
        while getgenv().autoJoinBrawl and task.wait(0.5) do
            if not getgenv().autoJoinBrawl then break end
            
            if game.Players.LocalPlayer.PlayerGui.gameGui.brawlJoinLabel.Visible then
                game.ReplicatedStorage.rEvents.brawlEvent:FireServer("joinBrawl")
                game.Players.LocalPlayer.PlayerGui.gameGui.brawlJoinLabel.Visible = false
            end
        end
    end)
end)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local godModeToggle = false

local function autoJoinBrawl()
    while godModeToggle do
        pcall(function()
            ReplicatedStorage.rEvents.brawlEvent:FireServer("joinBrawl")
        end)
        task.wait(0.1)
    end
end

Farming:AddSwitch("God Mode", function(state)
    godModeToggle = state
    if state then
        task.spawn(autoJoinBrawl)
    end
end)

player.CharacterAdded:Connect(function()
    if godModeToggle then
        task.spawn(autoJoinBrawl)
    end
end)
